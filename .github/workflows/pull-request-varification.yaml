name: Pull Request Verification
defaults:
  run:
    # æ˜ç¤ºçš„ã«shellã‚’æŒ‡å®šã™ã‚‹ã¨ "pipefail"ãŒæš—é»™çš„ã«è¨­å®šã•ã‚Œå®‰å…¨æ€§ãŒå‘ä¸Šã™ã‚‹
    shell: bash
on:
  pull_request:
concurrency:
  group: ${{github.workflow}}-${{github.ref}}
  # æ–°ã—ã„å¤‰æ›´ã‚’æ¤œçŸ¥ã—ãŸéš›ã€ã™ã§ã«å®Ÿè¡Œä¸­ã®ã‚¸ãƒ§ãƒ–ã¯ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã™ã‚‹ (ãƒ—ãƒ«ãƒªã‚¯ã®ãƒ†ã‚¹ãƒˆã¯æœ€æ–°ã®ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã ã‘æ¤œè¨¼ã—ãŸã„ãŸã‚)
  cancel-in-progress: true
jobs:
  linter-formatter:
    runs-on: ubuntu-latest
    steps:
      - name: "checkout"
        uses: actions/checkout@v6

      - name: "setup java"
        uses: actions/setup-java@v5
        with:
          distribution: 'corretto'
          java-version: '21'

      - name: "setup gradle"
        uses: gradle/actions/setup-gradle@v5

      - name: "./gradleãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œã™ã‚‹æ¨©é™ã‚’ä»˜ä¸"
        run: chmod +x ./gradlew

      - name: "ktlint"
        run: ./gradlew ktlintCheck

  unit-test:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
    steps:
      - name: "checkout"
        uses: actions/checkout@v6

      - name: "setup java"
        uses: actions/setup-java@v5
        with:
          distribution: 'corretto'
          java-version: '21'

      - name: "setup gradle"
        uses: gradle/actions/setup-gradle@v5

      - name: "./gradleãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œã™ã‚‹æ¨©é™ã‚’ä»˜ä¸"
        run: chmod +x ./gradlew

      - name: "test & ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®š"
        run: ./gradlew :inaba-service:jacocoTestReport

      - name: "testã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«æ›¸ãè¾¼ã‚€"
        id: jacoco
        uses: madrapps/jacoco-report@v1.7.2
        with:
          paths: |
            ${{ github.workspace }}/inaba-service/build/reports/jacoco/test/jacocoTestReport.xml,
          token: ${{ secrets.GITHUB_TOKEN }}
          title: "ã¡ã‚ƒã‚“ã¨ãƒ†ã‚¹ãƒˆæ›¸ã„ãŸã®ã‹æ¤œè¨¼ã™ã‚‹ã‚ˆ(*'Ï‰'*)"
          min-coverage-overall: 80
          min-coverage-changed-files: 80
          pass-emoji: ğŸ˜„
          fail-emoji: ğŸ˜ 
          continue-on-error: false